---
apiVersion: {{ kubeadm_join_worker.join_config.api_version }}
kind: {{ kubeadm_join_worker.join_config.kind }}
nodeRegistration:
  name: "{{ inventory_hostname }}"
  kubeletExtraArgs:
    - name: "cgroup-driver"
      value: "{{ kubeadm_join_worker.join_config.cgroup_driver }}"
discovery:
  bootstrapToken:
{% if (groups['master'] | length) > 1 %}
    apiServerEndpoint: "{{ k8s_ha_virtual_ip }}:6443"
{% else %}
    apiServerEndpoint: "{{ hostvars[groups['master'][0]]['advertise_ip'] }}:6443"
{% endif %}
    token: "{{ hostvars[groups['master'][0]]['kubeadm_token'] }}"
    caCertHashes:
      - "sha256:{{ hostvars[groups['master'][0]]['kubeadm_ca_hash'] }}"
    unsafeSkipCAVerification: {{ kubeadm_join_worker.join_config.ca_verification_skip | lower }}
