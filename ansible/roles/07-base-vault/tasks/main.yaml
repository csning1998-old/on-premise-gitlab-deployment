---
- name: "Block A: Install Dependencies"
  become: true
  block:
    - name: "Step A1. Update apt cache"
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600

    - name: "Step A2. Ensure unzip is installed"
      ansible.builtin.apt:
        name: unzip
        state: present

- name: "Block B: Disable Swap"
  become: true
  block:
    - name: "Step B1. Check if swap is active"
      ansible.builtin.command: swapon --show
      register: swapon_check
      changed_when: false
      failed_when: false

    - name: "Step B2. Disable swap if it is active"
      ansible.builtin.command: swapoff -a
      when: swapon_check.stdout != ""
      changed_when: true

    - name: "Step B3. Comment out swap entries in /etc/fstab"
      ansible.builtin.replace:
        path: /etc/fstab
        regexp: '^([^#].*?\sswap\s+.*)$'
        replace: '# \1'
